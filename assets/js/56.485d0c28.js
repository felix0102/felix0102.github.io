(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{95:function(t,a,e){"use strict";e.r(a);var _=e(0),v=Object(_.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h3",{attrs:{id:"不同cdb之间迁移pdb"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#不同cdb之间迁移pdb"}},[t._v("#")]),t._v(" 不同CDB之间迁移PDB")]),t._v(" "),e("h3",{attrs:{id:"测试环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#测试环境"}},[t._v("#")]),t._v(" 测试环境")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("源环境")]),t._v(" "),e("th",[t._v("目标环境")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("主机操作系统 Oracle Linux 7.2")]),t._v(" "),e("td",[t._v("主机操作系统 Oracle Linux 7.2")])]),t._v(" "),e("tr",[e("td",[t._v("主机名zhankys")]),t._v(" "),e("td",[t._v("主机名zhanky2")])]),t._v(" "),e("tr",[e("td",[t._v("Oracle版本 11.2.0.1 x64")]),t._v(" "),e("td",[t._v("Oracle版本 11.2.0.1 x64")])]),t._v(" "),e("tr",[e("td",[t._v("IP：172.16.171.214")]),t._v(" "),e("td",[t._v("IP：172.16.171.215")])]),t._v(" "),e("tr",[e("td",[t._v("CDB=orcl")]),t._v(" "),e("td",[t._v("CDB=cs")])]),t._v(" "),e("tr",[e("td",[t._v("被克隆的PDB=orcl1")]),t._v(" "),e("td",[t._v("克隆后的PDB=cs2")])])])]),t._v(" "),e("p",[t._v("测试思路")]),t._v(" "),e("p",[t._v("1、源端建立CP拥有create pluggable database和create session的权限（在PDB orcle1下创建用户）")]),t._v(" "),e("p",[t._v("2、将源端设置为只读模式（CDB模式下设置）")]),t._v(" "),e("p",[t._v("3、在目标端添加orcl1的tnsnames（在tnsnames.ora中添加）")]),t._v(" "),e("p",[t._v("4、在目标端创建orcle1的dblink：cp_link （在CDB模式下运行）")]),t._v(" "),e("p",[t._v("5、在目标端指定db_create_file_dest路径（在CDB模式下运行，如果目录不存在需事先创建）")]),t._v(" "),e("p",[t._v("6、执行克隆PDB语句（在CDB模式下运行）")]),t._v(" "),e("p",[t._v("7、检查数据是否正确(在PDB模式下运行)\n源端\n[oracle@zhanky ~]$ sqlplus / as sysdba")]),t._v(" "),e("p",[t._v("SQL*Plus: Release 12.2.0.1.0 Production on Fri Aug 3 16:21:35 2018")]),t._v(" "),e("p",[t._v("Copyright (c) 1982, 2016, Oracle.  All rights reserved.")]),t._v(" "),e("p",[t._v("Connected to:\nOracle Database 12c Enterprise Edition Release 12.2.0.1.0 - 64bit Production")]),t._v(" "),e("p",[t._v("SQL> alter session set container=orcl1;\nSQL> select * from zky.aa;")]),t._v(" "),e("h2",{attrs:{id:"username"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#username"}},[t._v("#")]),t._v(" USERNAME")]),t._v(" "),e("p",[t._v("ZKY")]),t._v(" "),e("p",[t._v("1 rows selected.")]),t._v(" "),e("p",[t._v("SQL> create user cp identified by cp;")]),t._v(" "),e("p",[t._v("User created.")]),t._v(" "),e("p",[t._v("SQL> grant create session,create pluggable database to cp;")]),t._v(" "),e("p",[t._v("Grant succeeded.")]),t._v(" "),e("p",[t._v("SQL> alter session set container=CDB$ROOT;\nSQL> alter pluggable database orcl1 close;")]),t._v(" "),e("p",[t._v("Pluggable database altered.")]),t._v(" "),e("p",[t._v("SQL> show pdbs")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("CON_ID")]),t._v(" "),e("th",[t._v("CON_NAME")]),t._v(" "),e("th",[t._v("OPEN MODE")]),t._v(" "),e("th",[t._v("RESTRICTED")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("2")]),t._v(" "),e("td",[t._v("PDB$SEED")]),t._v(" "),e("td",[t._v("READ")]),t._v(" "),e("td",[t._v("ONLY")])]),t._v(" "),e("tr",[e("td",[t._v("3")]),t._v(" "),e("td",[t._v("ORCL1")]),t._v(" "),e("td",[t._v("READ")]),t._v(" "),e("td",[t._v("ONLY")])]),t._v(" "),e("tr",[e("td",[t._v("4")]),t._v(" "),e("td",[t._v("ORCL2")]),t._v(" "),e("td",[t._v("READ")]),t._v(" "),e("td",[t._v("WRITE")])])])]),t._v(" "),e("p",[t._v("SQL>")]),t._v(" "),e("p",[t._v("目的端")]),t._v(" "),e("p",[t._v("[oracle@zhanky2 ~]$ vi /u01/app/oracle/product/12.2.0/db_1/network/admin/tnsnames.ora\n[oracle@zhanky2 ~]$ cat /u01/app/oracle/product/12.2.0/db_1/network/admin/tnsnames.ora")]),t._v(" "),e("h1",{attrs:{id:"tnsnames-ora-network-configuration-file-u01-app-oracle-product-12-2-0-db-1-network-admin-tnsnames-ora"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#tnsnames-ora-network-configuration-file-u01-app-oracle-product-12-2-0-db-1-network-admin-tnsnames-ora"}},[t._v("#")]),t._v(" tnsnames.ora Network Configuration File: /u01/app/oracle/product/12.2.0/db_1/network/admin/tnsnames.ora")]),t._v(" "),e("h1",{attrs:{id:"generated-by-oracle-configuration-tools"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#generated-by-oracle-configuration-tools"}},[t._v("#")]),t._v(" Generated by Oracle configuration tools.")]),t._v(" "),e("p",[t._v("LISTENER_CS =\n(ADDRESS = (PROTOCOL = TCP)(HOST = 172.16.171/215)(PORT = 1521))")]),t._v(" "),e("p",[t._v("CS1 =\n(DESCRIPTION =\n(ADDRESS = (PROTOCOL = TCP)(HOST = 172.16.171.215)(PORT = 1521))\n(CONNECT_DATA =\n(SERVER = DEDICATED)\n(SERVICE_NAME = cs1.zhanky.com)\n)\n)")]),t._v(" "),e("p",[t._v("CS =\n(DESCRIPTION =\n(ADDRESS = (PROTOCOL = TCP)(HOST = 172.16.171.215)(PORT = 1521))\n(CONNECT_DATA =\n(SERVER = DEDICATED)\n(SERVICE_NAME = cs.zhanky.com)\n)\n)")]),t._v(" "),e("p",[t._v("orcl1 =\n(DESCRIPTION =\n(ADDRESS = (PROTOCOL = TCP)(HOST = 172.16.171.214)(PORT = 1521))\n(CONNECT_DATA =\n(SERVER = DEDICATED)\n(SERVICE_NAME = orcl1.zhanky.com)\n)\n)\n[oracle@zhanky2 ~]$\nSQL> create database link cp_link connect to cp identified by cp using 'orcl1';")]),t._v(" "),e("p",[t._v("Database link created.")]),t._v(" "),e("p",[t._v("SQL> select count(*) from all_users@cp_link;")]),t._v(" "),e("h2",{attrs:{id:"count"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#count"}},[t._v("#")]),t._v(" COUNT(*)")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[t._v("41\n")])])]),e("p",[t._v("SQL> alter system set db_create_file_dest='/u01/app/oracle/oradata/cs/cs2';")]),t._v(" "),e("p",[t._v("System altered.")]),t._v(" "),e("p",[t._v("SQL> create pluggable database cs2 from orcl1@cp_link;")]),t._v(" "),e("p",[t._v("Pluggable database created.")]),t._v(" "),e("p",[t._v("SQL> show pdbs")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[t._v("CON_ID CON_NAME              OPEN MODE  RESTRICTED\n")])])]),e("hr"),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[t._v(" 2 PDB$SEED              READ ONLY  NO\n 3 CS1                  READ WRITE NO\n 4 CS2                  MOUNTED\n")])])]),e("p",[t._v("SQL> alter session set container=cs2;")]),t._v(" "),e("p",[t._v("Session altered.")]),t._v(" "),e("p",[t._v("SQL> startup\nPluggable Database opened.\nSQL> select * from zky.aa;")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("USERNAME")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("ZKY")])])])]),t._v(" "),e("p",[t._v("1 rows selected.")]),t._v(" "),e("p",[t._v("SQL>")])])}),[],!1,null,null,null);a.default=v.exports}}]);