(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{256:function(e,a,t){"use strict";t.r(a);var _=t(6),l=Object(_.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h3",{attrs:{id:"expdp-导出"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#expdp-导出"}},[e._v("#")]),e._v(" expdp 导出")]),e._v(" "),t("h3",{attrs:{id:"查询data-pump-dir"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查询data-pump-dir"}},[e._v("#")]),e._v(" 查询DATA_PUMP_DIR")]),e._v(" "),t("ul",[t("li",[e._v("select * from dba_directories;")]),e._v(" "),t("li",[e._v("/rdsdbdata/datapump")])]),e._v(" "),t("p",[e._v("CREATE DIRECTORY dmpdir AS '/rdsdbdata/datapump'")]),e._v(" "),t("p",[e._v("CREATE DIRECTORY dmpdir AS '/u01/dmpdir'")]),e._v(" "),t("p",[e._v("DPUMP_DIR1\n/rdsdbdata/userdirs/01")]),e._v(" "),t("h3",{attrs:{id:"检查是否有写的权限"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查是否有写的权限"}},[e._v("#")]),e._v(" 检查是否有写的权限")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("DECLARE\nfilehandle utl_file.file_type;begin\nfilehandle:= utl_file.fopen('dmpdir','test.txt','w');\nutl_file.put_line(filehandle,'test 1 write one.');\nutl_file.put_line(filehandle,'你好!');\nutl_file.fclose(filehandle);\nend;\n")])])]),t("h3",{attrs:{id:"查询当前运行的job"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查询当前运行的job"}},[e._v("#")]),e._v(" 查询当前运行的job")]),e._v(" "),t("ul",[t("li",[e._v("select job_name, owner_name,state from dba_datapump_jobs;")])]),e._v(" "),t("h3",{attrs:{id:"列出-data-pump-dir-中的文件。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#列出-data-pump-dir-中的文件。"}},[e._v("#")]),e._v(" 列出 DATA_PUMP_DIR 中的文件。")]),e._v(" "),t("ul",[t("li",[e._v("select * from table(RDSADMIN.RDS_FILE_UTIL.LISTDIR('DATA_PUMP_DIR')) order by mtime;")])]),e._v(" "),t("h3",{attrs:{id:"导出schema"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#导出schema"}},[e._v("#")]),e._v(" 导出Schema")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("DECLARE\nhdnl NUMBER;\nBEGIN\nhdnl := DBMS_DATAPUMP.OPEN( operation => 'EXPORT', job_mode => 'SCHEMA', job_name=>'felixExpdp-schema-siebel');\nDBMS_DATAPUMP.ADD_FILE( handle => hdnl, filename => 'schema-siebel.dmp', directory => 'DATA_PUMP_DIR', filetype => dbms_datapump.ku$_file_type_dump_file);\nDBMS_DATAPUMP.ADD_FILE( handle => hdnl, filename => 'schema-siebel.log', directory => 'DATA_PUMP_DIR', filetype => dbms_datapump.ku$_file_type_log_file);\nDBMS_DATAPUMP.METADATA_FILTER(hdnl,'SCHEMA_EXPR','IN (''SIEBEL'')');\nDBMS_DATAPUMP.SET_PARALLEL(hdnl,6);\nDBMS_DATAPUMP.START_JOB(hdnl);\nEND;\n/ \n")])])]),t("h3",{attrs:{id:"导出特定的表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#导出特定的表"}},[e._v("#")]),e._v(" 导出特定的表")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("导出特定表table(表模式)\n\n\tDECLARE\n\t   l_dp_handle        NUMBER;\n\t   l_last_job_state   VARCHAR2 (30) := 'UNDEFINED';\n\t   l_job_state        VARCHAR2 (30) := 'UNDEFINED';\n\t   l_sts              KU$STATUS;\n\tBEGIN\n\t   l_dp_handle :=\n\t      DBMS_DATAPUMP.open (operation     => 'EXPORT'\n\t                        , job_mode      => 'TABLE'\n\t                        , remote_link   => NULL\n\t                        , job_name      => 'JOB_EXP2'\n\t                        , version       => 'LATEST');\n\t   DBMS_DATAPUMP.\n\t    add_file (handle      => l_dp_handle\n\t            , filename    => 'emp_tbl.dmp'\n\t            , directory   => 'DB_DUMP_DIR'\n\t            , filetype    => DBMS_DATAPUMP.KU$FILE_TYPE_DUMP_FILE);\n\t   DBMS_DATAPUMP.\n\t    add_file (handle      => l_dp_handle\n\t            , filename    => 'emp_tbl.log'\n\t            , directory   => 'DB_DUMP_DIR'\n\t            , filetype    => DBMS_DATAPUMP.KU$FILE_TYPE_LOG_FILE);\n\t   --\x3e如果非当前帐户，使用下面的过滤条件，即特定schema下的特定表，如为当前帐户，此过滤条件可省略\n\t   DBMS_DATAPUMP.\n\t    metadata_filter (handle   => l_dp_handle\n\t                   , name     => 'SCHEMA_EXPR'\n\t                   , VALUE    => 'IN(''SCOTT'')');\n\t   DBMS_DATAPUMP.\n\t    metadata_filter (handle   => l_dp_handle\n\t                   , name     => 'NAME_EXPR'\n\t                   , VALUE    => 'IN(''EMP'')');\n\t   DBMS_DATAPUMP.start_job (l_dp_handle);\n\t   DBMS_DATAPUMP.detach (l_dp_handle);\n\tEND;\n")])])]),t("h3",{attrs:{id:"导出siebel-s-audit-item"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#导出siebel-s-audit-item"}},[e._v("#")]),e._v(" 导出SIEBEL.S_AUDIT_ITEM")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("DECLARE\nhdnl NUMBER;\nBEGIN\nhdnl := DBMS_DATAPUMP.OPEN( operation => 'EXPORT', job_mode => 'TABLE', job_name=>'felixExpdp-3');\nDBMS_DATAPUMP.ADD_FILE( handle => hdnl, filename => 'S_AUDIT_ITEM-3.dmp', directory => 'DATA_PUMP_DIR', filetype => dbms_datapump.ku$_file_type_dump_file);\nDBMS_DATAPUMP.ADD_FILE( handle => hdnl, filename => 'S_AUDIT_ITEM-3.log', directory => 'DATA_PUMP_DIR', filetype => dbms_datapump.ku$_file_type_log_file);\nDBMS_DATAPUMP.SET_PARALLEL(hdnl,4);\nDBMS_DATAPUMP.METADATA_FILTER(hdnl,'SCHEMA_EXPR','IN(''SIEBEL'')');\nDBMS_DATAPUMP.METADATA_FILTER(hdnl,'NAME_EXPR','IN(''S_AUDIT_ITEM'')');\nDBMS_DATAPUMP.START_JOB(hdnl);\nEND;\n")])])]),t("h3",{attrs:{id:"查看到expdp导出日志。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看到expdp导出日志。"}},[e._v("#")]),e._v(" 查看到expdp导出日志。")]),e._v(" "),t("ul",[t("li",[e._v("SELECT text FROM table(rdsadmin.rds_file_util.read_text_file('BDUMP','dbtask-1576751562884-132.log'));")])]),e._v(" "),t("h3",{attrs:{id:"将转储文件上传到-amazon-s3-存储桶。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#将转储文件上传到-amazon-s3-存储桶。"}},[e._v("#")]),e._v(" 将转储文件上传到 Amazon S3 存储桶。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("SELECT rdsadmin.rdsadmin_s3_tasks.upload_to_s3(\n      p_bucket_name    =>  'archivestore1-sa-gsis-aws',       \n      p_directory_name =>  'DATA_PUMP_DIR') \n   AS TASK_ID FROM DUAL;            \n\n")])])]),t("h3",{attrs:{id:"aws-s3-get-objecy"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#aws-s3-get-objecy"}},[e._v("#")]),e._v(" AWS s3 get objecy")]),e._v(" "),t("ul",[t("li",[e._v("aws2 s3api get-object --bucket archivestore1-sa-gsis-aws  --key S_AUDIT_READ.log a.log")])]),e._v(" "),t("h3",{attrs:{id:"目录权限错误"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#目录权限错误"}},[e._v("#")]),e._v(" 目录权限错误")]),e._v(" "),t("ul",[t("li",[e._v("注意要有该目录，要有权限，不能有重复的文件，比如已经执行过一次了，下一次会出现错误。")]),e._v(" "),t("li",[e._v("注意大小写，ORACLE数据库尽量都用大写吧，免得麻烦。")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('ERROR at line 1:\nORA-39001: invalid argument value\nORA-06512: at "SYS.DBMS_SYS_ERROR", line 79\nORA-06512: at "SYS.DBMS_DATAPUMP", line 4932\nORA-06512: at "SYS.DBMS_DATAPUMP", line 5183\nORA-06512: at line 5\n\n')])])]),t("h3",{attrs:{id:"注意事项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[e._v("#")]),e._v(" 注意事项")]),e._v(" "),t("ul",[t("li",[e._v("1、使用schema模式导出时，如果导出的schema为当前schema,则不需要指定schema过滤条件，否则需要对schema进行过滤")]),e._v(" "),t("li",[e._v("2、使用table表模式导出时，如果导出的表为当前schema,则不需要指定schema过滤条件，否则需要对schema进行过滤")]),e._v(" "),t("li",[e._v("3、对于过滤表上的特定记录可以使用多种SQL表达式，如 LIKE, NOT LIKE,IN, NOT IN, = , != 符号等")]),e._v(" "),t("li",[e._v("4、需要注意单引号的使用，尤其是在字符型的数据类型时，两个单引号代表一个引号")]),e._v(" "),t("li",[e._v("5、如果在导出时存在同样的dump文件和日志文件时PL/SQL块将执行失败，删除或通过写PL/SQL来判断文件是否存在，如存在是否覆盖等")]),e._v(" "),t("li",[e._v("6、如果指定了job_name，则当前job失败之后，再次执行时会碰到job已经存在的提示，建议让系统自动生成job_name简化管理")])]),e._v(" "),t("h3",{attrs:{id:"reference-link"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#reference-link"}},[e._v("#")]),e._v(" Reference Link")]),e._v(" "),t("ul",[t("li",[e._v("https://docs.aws.amazon.com/zh_cn/AmazonRDS/latest/UserGuide/Oracle.Procedural.Importing.html#Oracle.Procedural.Importing.DataPump.Step7")]),e._v(" "),t("li",[e._v("https://cloud.tencent.com/developer/article/1184387")]),e._v(" "),t("li",[e._v("https://www.oracle-scripts.net/cleanup-orphaned-datapump-jobs/")])])])}),[],!1,null,null,null);a.default=l.exports}}]);